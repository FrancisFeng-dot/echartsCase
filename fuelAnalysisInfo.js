$(function(){ 	var deptId = $("#deptId").val();//初始化当前机构ID		//加载 能耗趋势图	loadFuel();		//机构概况 信息	findDeptDetail();	//能耗排名加载	drivingRank('container21','vehicle','fuelAvg');	drivingRank('container31','vehicle','fuelHK');	//能耗超标比查询	drivingRank('container41','vehicle','fuelExc');	drivingRank('container51','driver','fuelExc');	//初始化底部列表分页	var grid = $.grid.init('grid_fuel', 'vehicleFuelService', orgGridRenderer);	//绑定底部列表切换事件	$("#fuelList").click(function(){			query();	});		//能耗选择器	jQuery(".fuelType").find(".radio").bind("click", function () {		$(this).addClass("acur").siblings().removeClass("acur");		var radio_val = $("input[name='tab'][type='radio']:checked").val();		$("#fuelType").val(radio_val);			if(radio_val=='fuelAvg'){			$("#map_name").html("能耗热点图（/车/日）");		}else if(radio_val=='fuelHK'){			$("#map_name").html("百公里能耗热点图");		}else if(radio_val=='fuelExc'){			$("#map_name").html("能耗超标比热点图");		}		//加载 能耗趋势图		loadFuel();	});}); //初始化 chart数据 var container2 = null;//暂存比例图数据var container2Categories = null;//暂存分析图数据var container2Data = null;//--------------------------能耗趋势图  START-------------------------------------------//能耗趋势图function loadFuel(){	var queryDay = $("#queryDay").val();	var deptId = $("#deptId").val();	var fuelType = $("#fuelType").val();		//初始化 能耗趋势图	$('#container2').highcharts({			chart : {				type : 'line'			},			title : {				text : ''			},			xAxis : {				categories : [],				labels : {					rotation : -45,					align : 'right',					style : {						fontSize : '12px',						fontFamily : 'Verdana, sans-serif'					}				}			},			yAxis : {				min:0, // 定义最小值  				title : {					text : 'L'				}			},			tooltip : {				valueSuffix : 'L'			},			series : []	});	container2 = $('#container2').highcharts();		//加载图表数据	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/topicFuelAnalysis/fuel.do',		"dataType" : "json",		"data" : {			deptId : deptId,			queryDay : queryDay,			fuelType : fuelType		},		"success" : function(resp) {			container2Categories = resp["container2"]["categories"];			container2Data = resp["container2"]["data"];			createChart();					}	});}//构造图表function createChart() {		if (typeof (container2Data) != "undefined") {		container2.setTitle( {text: '能耗趋势图' });		//更新趋势图数据		var feeTendencySeries = eval(container2Data);		clearChart(container2);		$.each(feeTendencySeries, function(n, value) {			container2.addSeries(value, false);		});		container2.xAxis[0].setCategories(eval(container2Categories),true);	}else{		container2.setTitle( {text: '暂无数据' });	}}//清理原有图层function clearChart(chart) {	var series = chart.series;	while (series.length > 0) {		series[0].remove(false);	}}//---------------------------危险驾驶行为机构热点图  END-------------------------------------------//----------------------------底部列表查询方法 start-------------------------------------------------function query(pageStart) {		var query = serializeArrayByForm('query_vehicleFuel');	if(isNotNull(pageStart)){		query['new_page_start'] = pageStart;	}	query['deptId'] = $("#deptId").val();	query['queryDay'] = $("#queryDay").val();	$('#grid_fuel').trigger('grid.query', [ query ]);}	function orgGridRenderer(data, idx) {	var trCfg = {		tdList : [			{text : data.RM},			{text : data.DEPT_NAME},			{text : data.MODEL_NAME},			{text : '<a href="javascript:void(0)" onclick="loadReport('+"'"+data.VEHICLE_ID+"'"+')">'+data.VEHICLE_CODE+'</a>'},			{text : data.MILEAGE},			{text : data.FUEL},			{text : data.FUEL_HK},			{text : data.DRIVER_TIME},			{text : data.AVG_SPEED}		]	}; 	return trCfg;}	function loadReport(vehicleId){	openTab('行车报告',ctx+'/resourcesManage/drivingReport/index.do?vehicleId='+vehicleId);}//----------------------------底部列表展示 end---------------------------------------------------//----------------------------------------------------------------//日期查询选择器function selDate(num){		if(null == num || "" == num || 0 == num){		num = 7;	}	$("#queryDay").val(num);			//以下是调用触所有要联动的表图	loadFuel();//能耗趋势图	//机构概况 信息	findDeptDetail();	//能耗排名加载	drivingRank('container21','vehicle','fuelAvg');	drivingRank('container31','vehicle','fuelHK');		//能耗超标比查询	drivingRank('container41','vehicle','fuelExc');	drivingRank('container51','driver','fuelExc');	//底部列表	if($("#fuelList").parent().attr("class")=='active'){		$("#fuelList").click();	}}//--------------------------- 机构概况信息 start-------------------------------------------function findDeptDetail(){	var deptId = $("#deptId").val();	var isLastDept = $("#isLastDept").val();	var queryDay = $("#queryDay").val();	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/safetyAnalysis/findDeptDetail.do',		"dataType" : "json",		"data" : {			deptId : deptId,			num : queryDay,			isLastDept : isLastDept		},		"success" : function(deptInfo) {			if (typeof (deptInfo) != "undefined") {				$("#VEHICLE_NUMS").html(deptInfo["VEHICLE_NUMS"]);				$("#DRIVER_NUMS").html(deptInfo["DRIVER_NUMS"]);				$("#FAULT_VEHICLE_NUMS").html(deptInfo["FAULT_VEHICLE_NUMS"]);				$("#MILEAGE_TOTAL").html(deptInfo["MILEAGE_TOTAL"]);				$("#DRIVER_TIME_TOTAL").html(deptInfo["DRIVER_TIME_TOTAL"]);				$("#FUEL_TOTAL").html(deptInfo["FUEL_TOTAL"]);				$("#HUNDRED_FUEL_TOTAL").html(deptInfo["HUNDRED_FUEL_TOTAL"]);				findDeptDetailTopic(deptId,queryDay);			}		}	});}function findDeptDetailTopic(deptId,queryDay){	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/topicFuelAnalysis/findDeptDayFuelfeeData.do',		"dataType" : "json",		"data" : {			deptId : deptId,			num : queryDay		},		"success" : function(deptInfo) {			if (typeof (deptInfo) != "undefined") {				$("#FUEL_FEE").html(deptInfo["FUEL_FEE"]);			}		}	});}//--------------------------- 机构概况信息 END-------------------------------------------//---------------------------------驾驶行为排名 tab页切换 START----------------------------------------function drivingRank(divId,findType,typeFuel) {      $("#findType").val(findType);    findFuelOrderDate(findType,divId,typeFuel);    };//拿到能耗排序数据function findFuelOrderDate(findType,divId,typeFuel){	var deptId = $("#deptId").val();	var queryDay = $("#queryDay").val();	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/topicFuelAnalysis/findFuelOrder.do',		"dataType" : "json",		"data" : {			deptId : deptId,			num : queryDay,			typeFuel : typeFuel,			findType : findType		},		"success" : function(deptInfo) {			$("#"+divId+" ul").remove();			$("#"+divId).append(' <ul class="list" style="height: 330px;"> </ul>');			if(findType == "vehicle"){				if(typeFuel == "fuelExc"){										if ( deptInfo != '' && typeof (deptInfo) != "undefined") {						$("#"+divId+" ul").append('<li ><span class="w1">排名</span><span class="w1">车牌</span><span class="w1">车型</span><span class="w1">额定能耗 （L/100km） </span><span class="w1">能耗超标比（/日）</span></li>');						for (var i = 0; i <= deptInfo.length - 1; i++) {							var modelName = null;							if(deptInfo[i]["MODEL_NAME"].length > 15){								modelName = deptInfo[i]["MODEL_NAME"].substr(0,15)+'...';							}else{								modelName = deptInfo[i]["MODEL_NAME"];							}							var str = "'"+deptInfo[i]["VEHICLE_ID"]+"'";							$("#"+divId+" ul").append('<li><span class="w1">'+(i+1)+'</span> <span class="w1"><a href="#" onClick="findCarTrajectory('+str+')">'+deptInfo[i]["VEHICLE_CODE"]+'</a> </span> <span  title="'+deptInfo[i]["MODEL_NAME"]+'" class="w1">'+modelName+'</span> <span class="w1">'									+deptInfo[i]["MAX_FUEL"]+'</span><span class="w1">'+deptInfo[i]["FUELDEP"]+'</span></li>');						} 					}else{						$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');					}									}else{									if (deptInfo != '' && typeof (deptInfo) != "undefined") {						$("#"+divId+" ul").append('<li ><span class="w1">排名</span><span class="w1">车牌</span><span class="w1">车型</span><span class="w1">车龄(年)</span><span class="w1">能耗(L/日)</span></li>');						for (var i = 0; i <= deptInfo.length - 1; i++) {							var modelName = null;							if(deptInfo[i]["MODEL_NAME"].length > 15){								modelName = deptInfo[i]["MODEL_NAME"].substr(0,15)+'...';							}else{								modelName = deptInfo[i]["MODEL_NAME"];							}							var str = "'"+deptInfo[i]["VEHICLE_ID"]+"'";							$("#"+divId+" ul").append('<li><span class="w1">'+(i+1)+'</span> <span class="w1"><a href="#" onClick="findCarTrajectory('+str+')">'+deptInfo[i]["VEHICLE_CODE"]+'</a> </span> <span  title="'+deptInfo[i]["MODEL_NAME"]+'" class="w1">'+modelName+'</span> <span class="w1">'									+deptInfo[i]["YEARNUM"]+'</span><span class="w1">'+deptInfo[i]["FUELDEP"]+'</span></li>');						} 					}else{						$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');					}				}							}			if(findType == "dept"){				if ( deptInfo != '' && typeof (deptInfo) != "undefined") {					$("#"+divId+" ul").append('<li ><span class="w1">排名</span><span class="w1">机构</span><span class="w1">能耗(L/车/日)</span>');					for (var i = 0; i <= deptInfo.length - 1; i++) {						$("#"+divId+" ul").append('<li><span class="w1">'+(i+1)+'</span> <span class="w1"><a href="'+deptInfo[i]["DEPT_NAME"]+'">'+deptInfo[i]["DEPT_NAME"]+'</a> </span> <span class="w1">'+deptInfo[i]["AVG_FUEL"]+'</span> ');					} 				}else{					$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');				}			}						if(findType == "driver"){				if ( deptInfo != '' && typeof (deptInfo) != "undefined") {					$("#"+divId+" ul").append('<li ><span class="w1">排名</span><span class="w1">司机</span><span class="w1">里程</span><span class="w1">能耗超标比（/日）</span>');					for (var i = 0; i <= deptInfo.length - 1; i++) {						var str = "'"+deptInfo[i]["DRIVER_ID"]+"'";						$("#"+divId+" ul").append('<li><span class="w1">'+(i+1)+'</span> <span class="w1"><a href="#" onClick="findDriverTrajectory('+str+')">'+deptInfo[i]["DRIVER_NAME"]+'</a> </span> <span class="w1">'+deptInfo[i]["MILEAGE"]+'</span><span class="w1">'+deptInfo[i]["AVG_FUEL"]+'</span> ');					} 				}else{					$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');				}			}		}	});}//能耗超标比查询function drivingRankExc(divId,findType,typeFuel) {      $("#findType").val(findType);    findFuelOrderDateExc(findType,divId,typeFuel);    };//能耗超标排序数据function findFuelOrderDateExc(findType,divId,typeFuel){	var deptId = $("#deptId").val();	var queryDay = $("#queryDay").val();	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/topicFuelAnalysis/findFuelOrderExc.do',		"dataType" : "json",		"data" : {			deptId : deptId,			num : queryDay,			typeFuel : typeFuel,			findType : findType		},		"success" : function(deptInfo) {			$("#"+divId+" ul").remove();			$("#"+divId).append(' <ul class="list" style="height: 330px;"> </ul>');			if(findType == "vehicle"){								if (deptInfo != '' && typeof (deptInfo) != "undefined") {					$("#"+divId+" ul").append('<li ><span class="w1">排名</span><span class="w1">车牌</span><span class="w1">车型</span><span class="w1">额定能耗 （L/100km） </span><span class="w1">能耗超标比（/日）</span></li>');					for (var i = 0; i <= deptInfo.length - 1; i++) {						var modelName = null;						if(deptInfo[i]["MODEL_NAME"].length > 15){							modelName = deptInfo[i]["MODEL_NAME"].substr(0,15)+'...';						}else{							modelName = deptInfo[i]["MODEL_NAME"];						}						var str = "'"+deptInfo[i]["VEHICLE_ID"]+"'";						$("#"+divId+" ul").append('<li><span class="w1">'+(i+1)+'</span> <span class="w1"><a href="#" onClick="findCarTrajectory('+str+')">'+deptInfo[i]["VEHICLE_CODE"]+'</a> </span> <span  title="'+deptInfo[i]["MODEL_NAME"]+'" class="w1">'+modelName+'</span> <span class="w1">'								+deptInfo[i]["MAX_FUEL"]+'</span><span class="w1">'+deptInfo[i]["EXCESS_RATIO"]+'</span></li>');					} 				}else{					$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');				}							}			if(findType == "driver"){				if (deptInfo != '' && typeof (deptInfo) != "undefined") {					$("#"+divId+" ul").append('<li ><span class="w1">排名</span><span class="w1">司机</span><span class="w1">里程</span><span class="w1">能耗超标比（/日）</span>');					for (var i = 0; i <= deptInfo.length - 1; i++) {						var str = "'"+deptInfo[i]["DRIVER_ID"]+"'";						$("#"+divId+" ul").append('<li><span class="w1">'+(i+1)+'</span> <span class="w1"><a href="#" onClick="findDriverTrajectory('+str+')"> '+deptInfo[i]["DRIVER_NAME"]+'</a> </span> <span class="w1">'+deptInfo[i]["MILEAGE"]+'</span><span class="w1">'+deptInfo[i]["AVG_FUEL"]+'</span> ');					} 				}else{					$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');				}			}		}	});}//跳转至行车轨迹function findCarTrajectory(vehicelId){	var rel_url = ctx+ '/resourcesManage/drivingReport/index.do';	openTab('行车报告',rel_url+"?vehicleId="+vehicelId);}//跳转至驾驶员轨迹 function findDriverTrajectory(driverId){	var rel_url = ctx+ '/resourcesManage/driverDrivingReport/index.do';	openTab('驾驶报告',rel_url+"?driverId="+driverId+"&operation=view");}function openTab(name,url){	window.parent.$.fn.jerichoTab.addTab({         tabFirer: null,         title: name,         closeable: true,         data: {             dataType: 'iframe',             dataLink: url         }     }).showLoader().loadData();     resizeTab();}//---------------------------------驾驶行为排名 tab页切换 END----------------------------------------//excle导出function exportExcle(){	var deptId = $("#deptId").val();	var queryDay = $("#queryDay").val();	window.location.href=ctx+'/topicAnalysis/topicFuelAnalysis/exportVehicleDetail.do?deptId='+deptId+'&queryDay='+queryDay;}