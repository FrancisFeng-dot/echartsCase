$(function(){ 	$("#temp_urls").val(urls);	$("#temp_nowSelectId").val("select");	$("#deptId").val(parDeptId);//初始化当前机构ID	var query_dept = {			deptId : parDeptId,			fieldtext : "deptName",			fieldValue : "deptId"	} ;	//下拉框ID、条件、div的ID、用来输出选中的下拉框值、回调方法	var sl = $.initSelect.initFirstSelect('select', query_dept,'SelectBox1', 'deptId',callback);	//机构概况 信息	findDeptDetail();	//能耗排名加载	drivingRank('tab1_content','dept');		//加载能耗趋势图	loadFuel();		//加载  总能耗机构占比图 饼状图	loadFuelDept();		//地图热点	getMap();		//初始化底部列表分页	var grid = $.grid.init('grid_fuel', 'topicFuelAnalysisService', orgGridRenderer);	//绑定底部列表切换事件	$("#fuelList").click(function(){			query();	});	$("#fuelChart").click(function(){			//加载能耗趋势图		loadFuel();				//加载  总能耗机构占比图 饼状图		loadFuelDept();	});			//驾驶行为选择器	jQuery(".fuelType").find(".radio").bind("click", function () {		$(this).addClass("acur").siblings().removeClass("acur");		var radio_val = $("input[name='tab'][type='radio']:checked").val();		$("#typeFuel").val(radio_val);			if(radio_val=='fuelAvg'){			$("#map_name").html("能耗热点图（/车/日）");		}else if(radio_val=='fuelHK'){			$("#map_name").html("百公里能耗热点图");		}else if(radio_val=='fuelExc'){			$("#map_name").html("能耗超标比热点图");		}		getMap();		//地图热点		getMapJson(null,null,2);	});		//详细数据点击事件	$("#moreDetail").click(function(){		var queryDay = $("#queryDay").val();		var deptId = $("#deptId").val();		var findType = $("#findType").val();				var url = $(this).attr("rel_url")+"?deptId="+deptId+"&queryDay="+queryDay+"&findType="+findType;		//window.location.href = url;		openTab('里程能耗统计',url);			});}); //选中机构下拉宽后  回调方法function callback(data,selValue){	if ( (data == null || data.length == 0) && selValue != '-1' ){				var rel_url = ctx+ '/topicAnalysis/topicFuelAnalysis/fuelAnalysisInfo.do';		window.location.href=rel_url+"?deptId="+$("#deptId").val()+"&queryDay="+$("#queryDay").val()+"&fuelType="+$("#typeFuel").val();	}else{		//机构概况信息//		findDeptDetail();		 		//地图热点		getMapJson(null,null,2);			}}//初始化 chart数据 var container2 = null;var container3 = null;//暂存比例图数据var container2Categories = null;var container3Categories = null;//暂存分析图数据var container2Data = null;var container3Data = null;//---------------------------能耗趋势图 START-------------------------------------------//加载能耗趋势图function loadFuel(){	var queryDay = $("#queryDay").val();	var deptId = $("#deptId").val();		//初始化 危险驾驶行为趋势图	$('#container2').highcharts({			chart : {				type : 'line'			},			title : {				text : '',				y:6			},			xAxis : {				categories : [],				labels : {					rotation : -45,					align : 'right',					style : {						fontSize : '12px',						fontFamily : 'Verdana, sans-serif'					}				}			},			yAxis : {				min:0, // 定义最小值  				title : {					text : 'L'				}			},			tooltip : {				valueSuffix : 'L'			},			series : []	});	container2 = $('#container2').highcharts();	//加载图表数据	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/topicFuelAnalysis/fuel.do',		"dataType" : "json",		"data" : {			deptId : deptId,			queryDay : queryDay		},		"success" : function(resp) {			container2Categories = resp["container2"]["categories"];			container2Data = resp["container2"]["data"];			createChart("fuel");					}	});}//---------------------------能耗趋势图  END-------------------------------------------//---------------------------  总能耗机构占比图  STAST-------------------------------------------// 总能耗机构占比图function loadFuelDept(){		var queryDay = $("#queryDay").val();	var deptId = $("#deptId").val();	//初始化 总能耗机构占比图	$('#container3').highcharts({		chart : {			plotBackgroundColor : null,			plotBorderWidth : null,			plotShadow : false		},		title : {			text : '',			y:6		},		tooltip : {			pointFormat : '{series.name}: <b>{point.percentage:.1f}%</b>'		},		plotOptions : {			pie : {				allowPointSelect : true,				cursor : 'pointer',				dataLabels : {					enabled : true,					color : '#000000',					connectorColor : '#000000',					format : '<b>{point.name}</b>: {point.percentage:.1f} %'				}			}		},		series : [ {			type : 'pie',			name : '所占比例',			data : []		} ]	});	container3 = $('#container3').highcharts();	//加载图表数据	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/topicFuelAnalysis/fuelDept.do',		"dataType" : "json",		"data" : {			deptId : deptId,			queryDay : queryDay		},		"success" : function(resp) {						var objArr = eval(resp.pie);//joson对象转数组			container3Data = null;			for(var i=1;i<objArr.length;i++){				if(objArr[i][1]>0){					container3Data = resp["pie"];					break;					}			}						//container3Data = resp["pie"];			createChart("fuelDept");		}	});}//---------------------------  总能耗机构占比图 END-------------------------------------------//构造图表function createChart(tabName) {		if("fuel" == tabName){				if (typeof (container2Data) != "undefined") {			container2.setTitle( {text: '能耗趋势图' });			//更新趋势图数据			var feeTendencySeries = eval(container2Data);			if(container2 != null){				clearChart(container2);			}			if(feeTendencySeries != 'undefined' && feeTendencySeries != null && feeTendencySeries != ''){				$.each(feeTendencySeries, function(n, value) {					container2.addSeries(value, false);				});			}						container2.xAxis[0].setCategories(eval(container2Categories),true);		}else{			container2.setTitle( {text: '暂无数据' });		}			}else if("fuelDept" == tabName){		if (container3Data == null){			container3.setTitle( {text: '暂无数据' });		}else if(container3Data.length > 2) {			container3.setTitle( {text: '总能耗机构占比' });			var feePiedata = eval(container3Data);			//更新饼图数据			container3.series[0].update({				data : feePiedata			});		}else{			container3.setTitle( {text: '暂无数据' });		}	}	}//----------------------------------------------------------------//----------------------------地图热点图 start------------------------------------------------//定义地图var BMapExt;var myChart;function getMap(){		require.config({      paths: {          echarts: '../../js/map/doc/example/www/js'      },      packages: [          {              name: 'BMap',              location: '../../js/map/extension/BMap/src',              main: 'main'          }      ]  });  require(  [      'echarts',      'BMap',      'echarts/chart/map'  ],  function (echarts, BMapExtension) {      $('#main').css({          height:$('#main').parent().height(),          width: $('#main').parent().width()      });          var url = $("#mapFrom").attr("action");    var queryDay = $("#queryDay").val();  	var typeFuel = $("#typeFuel").val();  	var deptId = parDeptId;      $.ajax({          type: "POST",          url: url,          data: {deptId:deptId,queryDay:queryDay,typeFuel:typeFuel},          dataType: "json",          success: function(data){          	// 初始化地图          	BMapExt = new BMapExtension($('#main')[0], BMap, echarts,{          	    enableMapClick: false          	});          	var map = BMapExt.getMap();          	var container = BMapExt.getEchartsContainer();          	var locations = [];    		$.each(data.son,function(key,values){    			if(values[0] != null && values[0] != ''){    				locations.push(values);	    			}    		});    		    		var point = new BMap.Point(locations[0][0], locations[0][1]);        	map.centerAndZoom(point, 8);        	          	map.enableScrollWheelZoom(true);          	// 地图自定义样式          	// 创建一个DOM元素        	  var divText = document.createElement("div");            // 添加文字说明            divText.appendChild(document.createTextNode("能耗趋势图"));            // 设置样式            divText.style.cursor = "pointer";            divText.style.border = "1px solid gray";            divText.style.backgroundColor = "white";            divText.style.position = "absolute";            divText.style.right = "5px";            divText.style.top = "5px";            divText.style.fontSize="15px";            divText.style.padding="3px";            map.getContainer().appendChild(divText);          	option = {          	    color: ['gold','aqua','lime'],          	    title : {          	        text: '',          	        subtext:'',          	        x:'right'          	    },          	    tooltip : {          	        trigger: 'item',          	        formatter: function (v) {          	        	if(typeof (v[1]) != 'undefined'){          	        		return v[1]+v[2]+data.unit;          	        	}else{          	        		return null;          	        	}          	                      	        }          	    },                  	    toolbox: {          	        show : false          	    },          	    dataRange: {          	        min : 0,          	        max : data.max,          	        y: '60%',          	        calculable : true,          	        color: ['#ff3333', 'orange', 'yellow','lime','aqua']          	    },          	    series : [          	        {          	            name:'子集',          	            type:'map',          	            mapType: 'none',          	            data:[],                      	            geoCoord: data.son,          				markLine : {          	                smooth:true,          	                effect : {          	                    show: true,          	                    scaleSize: 1,          	                    period: 30,          	                    color: '#fff',          	                    shadowBlur: 10          	                },          	                itemStyle : {          	                    normal: {          	                        borderWidth:1,          	                        lineStyle: {          	                            type: 'solid',          	                            shadowBlur: 10          	                        }          	                    }          	                },          	                data : [          	                ]          	            },          	            markPoint : {          	                symbol:'emptyCircle',          	                symbolSize : function (v){          	                    return 10 + v/10          	                },          	                effect : {          	                    show: true,          	                    shadowBlur : 0          	                },          	                itemStyle:{          	                    normal:{          	                        label:{show:false}          	                    }          	                },          	                data : data.num          	            }          	                      	        }          	    ]          	};          	if (myChart&& myChart.dispose) {          	    myChart.dispose();          	}          	myChart = BMapExt.initECharts(container);          	//绑定点击事件          	var ecConfig = require('echarts/config');          	function eConsole(param) {          		//var str = param.name + ":" + param.value;          		//机构详情//        		findDeptDetail();        		//地图钻取        		getMapJson(null,param.name);          	}          	myChart.on(ecConfig.EVENT.CLICK, eConsole);          	window.onresize = myChart.resize;          	BMapExt.setOption(option, true);          }      });  }  );}//获取MapJson数据function getMapJson(deptId,deptName,sel){	if(!deptId){		deptId = $("#deptId").val();	}		if(!sel){		sel = 1;	}		var url = $("#mapFrom").attr("action");    var queryDay = $("#queryDay").val();	var typeFuel = $("#typeFuel").val();		$("#temp_nowSelectId").val(this.nowSelectId);	$("#temp_urls").val(this.urls); 	$.ajax({      type: "POST",      url: url,      data: {deptId:deptId,queryDay:queryDay,typeFuel:typeFuel,deptName:deptName},      dataType: "json",      success: function(data){      	if(data.error){      		//错误情况：被选择机构下无下属机构或车辆      		alertMessage(data.error);      	}else{      		//修改机构ID值          	if(data.deptId){          		$("#deptId").val(data.deptId);          	}          	//判断是否为底层机构          	if(data.isLast){          		//底层机构则跳转至详情页面          		var url = $("#query_fuel").attr("last_url");          		window.location.href=url+"?deptId="+data.deptId+"&queryDay="+$("#queryDay").val()+"&fuelType="+typeFuel;          	}else{          		var a_ption = myChart.getOption();      			          		var  seriesList = a_ption.series;          		          		var  dataRange = a_ption.dataRange;        		        		seriesList[0].geoCoord = data.son;        		        		seriesList[0].markPoint.data = data.num;        		        		dataRange.max = data.max;        				        		a_ption.series = seriesList;        		        		a_ption.dataRange = dataRange;          		          		BMapExt.setOption(a_ption, true);          		          		var map = BMapExt.getMap();          		var locations = [];        		$.each(data.son,function(key,values){        			locations.push(values);        		});        		var point = new BMap.Point(locations[0][0], locations[0][1]);            	map.centerAndZoom(point, 8);          		          		//机构概况          		findDeptDetail();          		//能耗排名加载        		var findType = $("#findType").val();        		drivingRank('tab1_content',findType);        		        		//底部列表        		if($("#fuelList").parent().attr("class")=='active'){        			$("#fuelList").click();        		}else{        			//以下是调用触所有要联动的表图        			loadFuel();//加载能耗趋势图        			loadFuelDept();//加载  总能耗机构占比图 饼状图        		}	        		if(1 == sel){        			var nowSelectId = $("#temp_nowSelectId").val();            		var urls = $("#temp_urls").val();            		jsSelectItemByValue(nowSelectId,data.deptId);            		            		var query_dept = {            				deptId : data.deptId,            				fieldtext : "deptName",            				fieldValue : "deptId"            			} ;            		$.initSelect.ajaxNextSelect(urls, nowSelectId ,data.deptId, query_dept, 'SelectBox1',0);        		}	          	}    	      	}      	      }  });}//----------------------------地图热点图 end--------------------------------------------------//----------------------------底部列表查询方法 start-------------------------------------------------function query(pageStart,deptId,isLast) {		//如果为底层机构则跳转至底层机构详情页面	if(isLast&&isLast==1){		var url = $("#query_fuel").attr("last_url");		window.location.href=url+"?deptId="+deptId+"&queryDay="+$("#queryDay").val();	}else{		var query = serializeArrayByForm('query_behavior');		if(isNotNull(pageStart)){			query['new_page_start'] = pageStart;		}		if(isNotNull(deptId) && deptId != 'root'){			query['deptId'] = deptId;		}else{			query['deptId'] = 	$("#deptId").val();		}		var queryDay = $("#queryDay").val();		var typeFuel = $("#typeFuel").val();		query['queryDay'] = queryDay;		query['typeFuel'] = typeFuel;		$('#grid_fuel').trigger('grid.query', [ query ]);		//自动排序		//$("#grid_behavior").tablesorter(); 	}	}//excle导出function exportExcle(){	var deptId = $("#deptId").val();	var theads=$('#grid_fuel thead tr th');//获取所有的表头	var thead = "";	for ( var i = 0; i < theads.length; i++) {		thead = thead+$(theads[i]).html()+",";	}	var queryDay = $("#queryDay").val();	var ii = ctx;	thead = encodeURI(thead);	thead = encodeURI(thead);	window.location.href=ctx+'/topicAnalysis/topicFuelAnalysis/exportExcle.do?deptId='+deptId+'&thead='+thead+'&queryDay='+queryDay;	}	function orgGridRenderer(data, idx) {	var trCfg = {		tdList : [			{text : data.rowNo},			{text : '<a href="javascript:void(0)" onclick="getMapJson(null,'+"'"+data.deptName+"'"+');">'+data.deptName+'</a>'},			{text : data.vehicleNums},			{text : data.mileageTotal},			{text : data.fuelTotal},						{text : data.fuelAvg},			{text : data.fuelHK},			{text : (data.excessRatio*100).toFixed(2)+'%'},			{text : data.driverTimeTotal},			{text : data.avgSpeed}		]	}; 	return trCfg;}//----------------------------底部列表展示 end---------------------------------------------------//{text : '<a href="javascript:void(0)" onclick="query('+null+','+"'"+data.deptId+"'"+','+data.isLast+');">'+data.deptName+'</a>'},//日期查询选择器function selDate(num){		if(null == num || "" == num || 0 == num){		num = 7;	}	$("#queryDay").val(num);	//以下是调用触所有要联动的表图//	findDeptDetail();//机构概况 信息		getMapJson(null,null,2);//地图热点		//底部列表	if($("#fuelList").parent().attr("class")=='active'){		$("#fuelList").click();	}	}//--------------------------- 机构概况信息 start-------------------------------------------function findDeptDetail(){	var deptId = $("#deptId").val();	var queryDay = $("#queryDay").val();	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/safetyAnalysis/findDeptDetail.do',		"dataType" : "json",		"data" : {			deptId : deptId,			num : queryDay		},		"success" : function(deptInfo) {			if (typeof (deptInfo) != "undefined") {				$("#VEHICLE_NUMS").html(deptInfo["VEHICLE_NUMS"]);				$("#DRIVER_NUMS").html(deptInfo["DRIVER_NUMS"]);				$("#FAULT_VEHICLE_NUMS").html(deptInfo["FAULT_VEHICLE_NUMS"]);				$("#MILEAGE_TOTAL").html(deptInfo["MILEAGE_TOTAL"]);				$("#DRIVER_TIME_TOTAL").html(deptInfo["DRIVER_TIME_TOTAL"]);			}		}	});}//--------------------------- 机构概况信息 END-------------------------------------------//---------------------------------驾驶行为排名 tab页切换 START----------------------------------------function drivingRank(divId,findType) {  	var typeFuel = $("#typeFuel").val();    $("#findType").val(findType);         if(typeFuel == 'fuelAvg'){    	document.getElementById('drivingRankName').innerHTML = '能耗排名';    }else if(typeFuel == 'fuelHK'){    	document.getElementById('drivingRankName').innerHTML = '百公里能耗排名';    }else{    	document.getElementById('drivingRankName').innerHTML = '能耗超标比排名';    }        findFuelOrderDate(findType,divId,typeFuel);    };//拿到能耗排序数据function findFuelOrderDate(findType,divId,typeFuel){	var deptId = $("#deptId").val();	var queryDay = $("#queryDay").val();	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/topicFuelAnalysis/findFuelOrder.do',		"dataType" : "json",		"data" : {			deptId : deptId,			num : queryDay,			typeFuel : typeFuel,			findType : findType		},		"success" : function(deptInfo) {			$("#"+divId+" ul").remove();			$("#"+divId).append(' <ul class="list" style="height:332px; padding:0 !important;"> </ul>');			if(findType == "vehicle"){				if (typeof (deptInfo) != "undefined") {					if(typeFuel == 'fuelExc'){						$("#"+divId+" ul").append('<li class="name"><span class="w2 color1">排名</span><span class="w2 color1">车牌</span><span class="w2 color1">车型</span><span class="w2 color1">额定能耗(L/100km)</span><span class="w2 color1" id="vehicleFulValue">能耗超标比(/日)</span></li>');							if(deptInfo!=''){								for (var i = 0; i <= deptInfo.length - 1; i++) {									var modelName = null;									if(deptInfo[i]["MODEL_NAME"].length > 8){										modelName = deptInfo[i]["MODEL_NAME"].substr(0,8)+'...';									}else{										modelName = deptInfo[i]["MODEL_NAME"];									}									var str = "'"+deptInfo[i]["VEHICLE_ID"]+"'";									$("#"+divId+" ul").append('<li><span class="w2">'+(i+1)+'</span> <span class="w2"><a href="#" title="'+deptInfo[i]["VEHICLE_CODE"]+'" onClick="findCarTrajectory('+str+')">'+deptInfo[i]["VEHICLE_CODE"]+'</a> </span> <span  title="'+deptInfo[i]["MODEL_NAME"]+'" class="w2">'+modelName+'</span> <span class="w2">'											+deptInfo[i]["MAX_FUEL"]+'</span><span class="w2">'+deptInfo[i]["FUELDEP"]+'</span></li>');								} 							}else{								$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');							}											}else{												if(typeFuel == 'fuelAvg'){							$("#"+divId+" ul").append('<li class="name"><span class="w2 color1">排名</span><span class="w2 color1">车牌</span><span class="w2 color1">车型</span><span class="w2 color1">车龄(年)</span><span class="w2 color1" id="vehicleFulValue">能耗(L/日)</span></li>');							if(deptInfo==''){								$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');							}					    }else if(typeFuel == 'fuelHK'){					    	$("#"+divId+" ul").append('<li class="name"><span class="w2 color1">排名</span><span class="w2 color1">车牌</span><span class="w2 color1">车型</span><span class="w2 color1">车龄(年)</span><span class="w2 color1" id="vehicleFulValue">百公里能耗(L/100km)</span></li>');					    	if(deptInfo==''){					    		$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');					    	}					    }																		for (var i = 0; i <= deptInfo.length - 1; i++) {							var modelName = null;							if(deptInfo[i]["MODEL_NAME"].length > 8){								modelName = deptInfo[i]["MODEL_NAME"].substr(0,8)+'...';							}else{								modelName = deptInfo[i]["MODEL_NAME"];							}							var str = "'"+deptInfo[i]["VEHICLE_ID"]+"'";							$("#"+divId+" ul").append('<li><span class="w2">'+(i+1)+'</span> <span class="w2"><a href="#" title="'+deptInfo[i]["VEHICLE_CODE"]+'" onClick="findCarTrajectory('+str+')">'+deptInfo[i]["VEHICLE_CODE"]+'</a> </span> <span  title="'+deptInfo[i]["MODEL_NAME"]+'" class="w2">'+modelName+'</span> <span class="w2">'									+deptInfo[i]["YEARNUM"]+'</span><span class="w2">'+deptInfo[i]["FUELDEP"]+'</span></li>');						} 					}									}							}			if(findType == "dept"){				if(typeFuel == 'fuelAvg'){					$("#"+divId+" ul").append('<li  class="name"><span class="w1 color1">排名</span><span class="w1 color1">机构</span><span class="w1 color1" id="deptFuelValue">能耗(L/车/日)</span>');					if(deptInfo==''){			    		$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');			    	}								    }else if(typeFuel == 'fuelHK'){			    	$("#"+divId+" ul").append('<li  class="name"><span class="w1 color1">排名</span><span class="w1 color1">机构</span><span class="w1 color1" id="deptFuelValue">百公里能耗(L/100km)</span>');			    	if(deptInfo==''){			    		$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');			    	}			    }else{			    	$("#"+divId+" ul").append('<li  class="name"><span class="w1 color1">排名</span><span class="w1 color1">机构</span><span class="w1 color1" id="deptFuelValue">能耗超标比（车/日 ）</span>');			    	if(deptInfo==''){			    		$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');			    	}			    }								if (typeof (deptInfo) != "undefined") {					for (var i = 0; i <= deptInfo.length - 1; i++) {						var cs = "'"+findType+"'"+",'"+divId+"','"+deptInfo[i]["DEPT_ID"]+"'";						$("#"+divId+" ul").append('<li><span class="w1">'+(i+1)+'</span> <span class="w1"><a href="#" title="'+deptInfo[i]["DEPT_NAME"]+'" onClick="findDeptFuelOrderDate('+cs+')">'+deptInfo[i]["DEPT_NAME"]+'</a> </span> <span class="w1">'+deptInfo[i]["AVG_FUEL"]+'</span> ');					} 				}							}						if(findType == "driver"){				if(typeFuel == 'fuelAvg'){					$("#"+divId+" ul").append('<li  class="name"><span class="w3 color1">排名</span><span class="w3 color1">司机</span><span class="w3 color1">里程</span><span class="w3 color1" id="driverFuleValue">能耗(L/车/日)</span>');					if(deptInfo==''){			    		$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');			    	}			    }else if(typeFuel == 'fuelHK'){			    	$("#"+divId+" ul").append('<li  class="name"><span class="w3 color1">排名</span><span class="w3 color1">司机</span><span class="w3 color1">里程</span><span class="w3 color1" id="driverFuleValue">百公里能耗(L/100km)</span>');			    	if(deptInfo==''){			    		$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');			    	}			    }else{			    	$("#"+divId+" ul").append('<li  class="name"><span class="w3 color1">排名</span><span class="w3 color1">司机</span><span class="w3 color1">里程</span><span class="w3 color1" id="driverFuleValue">能耗超标比（/日）</span>');			    	if(deptInfo==''){			    		$("#"+divId+" ul").append('<li style="text-align:center;"><span class="w8" style="float: none;">暂无数据</span></li>');			    	}			    }				if (typeof (deptInfo) != "undefined") {					for (var i = 0; i <= deptInfo.length - 1; i++) {						var cs = "'"+deptInfo[i]["DRIVER_ID"]+"'";						$("#"+divId+" ul").append('<li><span class="w3">'+(i+1)+'</span> <span class="w3"><a href="#" title="'+deptInfo[i]["DRIVER_NAME"]+'" onClick="findDriverTrajectory('+cs+')">'+deptInfo[i]["DRIVER_NAME"]+'</a> </span><span class="w3">'+deptInfo[i]["MILEAGE"]+'</span><span class="w3">'+deptInfo[i]["AVG_FUEL"]+'</span> ');					} 				}							}		}	});}//跳转至行车轨迹function findCarTrajectory(vehicelId){	var rel_url = ctx+ '/resourcesManage/drivingReport/index.do';	openTab('行车报告',rel_url+"?vehicleId="+vehicelId);}//跳转至司机轨迹function findDriverTrajectory(driverId){	var rel_url = ctx+ '/resourcesManage/driverDrivingReport/index.do';	openTab('驾驶报告',rel_url+"?driverId="+driverId);}/** * 创建新标签 * @param name * @param url */function openTab(name,url){	window.parent.$.fn.jerichoTab.addTab({         tabFirer: null,         title: name,         closeable: true,         data: {             dataType: 'iframe',             dataLink: url         }     }).showLoader().loadData();     resizeTab();}//点击机构查询机构下能耗信息function findDeptFuelOrderDate(findType,divId,deptId){	$("#deptId").val(deptId);	if(findDeptDetailInfo() == 1 ){		var rel_url = ctx+ '/topicAnalysis/topicFuelAnalysis/fuelAnalysisInfo.do';		window.location.href=rel_url+"?deptId="+$("#deptId").val()+"&queryDay="+$("#queryDay").val()+"&fuelType="+$("#typeFuel").val();	}else{		//机构概况 信息//		findDeptDetail();		//能耗排名加载//		drivingRank(divId,findType);		//地图热点		getMapJson();			}}//拿到机构信息function findDeptDetailInfo(){	var deptId = $("#deptId").val(); 	var isLast ; 	$.ajax({		"type" : 'post',		"url" : ctx+ '/topicAnalysis/safetyAnalysis/findDeptInfo.do',		"dataType" : "json",		"async" : false,  		"data" : {			deptId : deptId		},		"success" : function(deptInfo) {			if (typeof (deptInfo) != "undefined") {				 isLast = deptInfo.isLast ;			}		}	});	return isLast;}//---------------------------------驾驶行为排名 tab页切换 END----------------------------------------